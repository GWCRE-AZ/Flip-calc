{
  "audit_metadata": {
    "application_name": "CCRE Flip Analyzer - House Flipping Calculator",
    "audit_date": "2026-01-09",
    "discovery_complete": true,
    "fixes_complete": true,
    "phase": "complete"
  },
  "application_structure": {
    "type": "Real Estate Investment Calculator",
    "purpose": "Calculate profitability for house flipping, BRRRR strategy, and wholesale deals",
    "tech_stack": "React/TypeScript with Vite, Tailwind CSS, shadcn/ui components",
    "main_files": {
      "core_calculator": "client/src/lib/calculator.ts",
      "main_page": "client/src/pages/Home.tsx",
      "analysis_components": [
        "BRRRRAnalysis.tsx",
        "BreakEvenAnalysis.tsx",
        "WholesaleAnalysis.tsx",
        "SensitivityAnalysis.tsx",
        "ExitStrategiesTab.tsx",
        "PointsFeesComparison.tsx",
        "ComparisonMode.tsx",
        "CostPerSqFt.tsx",
        "RehabPresets.tsx",
        "ClosingCostItemization.tsx"
      ],
      "utilities": ["excelExport.ts"]
    }
  },
  "data_flow": {
    "inputs": "User enters property details, financing, rehab, holding, and selling costs",
    "calculation": "calculateResults() in calculator.ts processes all inputs",
    "outputs": "Net profit, ROI, Cash-on-Cash, and other metrics displayed in results panel",
    "dependencies": {
      "core_results": "All components depend on CalculatorInputs and CalculatorResults from calculator.ts",
      "secondary_calculations": "BRRRR, Wholesale, Break-Even components have their own calculations using base results"
    }
  },
  "issues_found": {
    "critical": [
      {
        "id": "CRIT-001",
        "file": "client/src/components/PointsFeesComparison.tsx",
        "line": 77,
        "severity": "CRITICAL",
        "type": "calculation_error",
        "description": "Uses non-existent property 'loanPoints' instead of 'originationPoints' in adjustedInputs",
        "code_snippet": "loanPoints: scenario.points,",
        "correct_code": "originationPoints: scenario.points,",
        "impact": "Lender comparison calculations use incorrect origination points - the adjusted inputs don't actually update points, causing all lender scenarios to use the same origination points value",
        "affected_features": ["Lender Comparison Tool"],
        "status": "FIXED",
        "fix_applied": "Changed 'loanPoints' to 'originationPoints' on line 77"
      },
      {
        "id": "CRIT-002",
        "file": "client/src/components/WholesaleAnalysis.tsx",
        "line": "112-113",
        "severity": "CRITICAL - RECLASSIFIED AS NOT A BUG",
        "type": "calculation_review",
        "description": "Upon review, the calculation in WholesaleAnalysis.tsx is CORRECT. EMD is added back because it was included in totalWholesalerCosts, making the net effect = assignmentFee - marketingCosts for assignments, and spread - marketing - closing - 2% for double_close",
        "impact": "No impact - calculation is mathematically correct",
        "affected_features": ["Wholesale Analysis - Net Profit calculation"],
        "status": "NO FIX NEEDED - CORRECT AS-IS"
      }
    ],
    "serious": [
      {
        "id": "SER-001",
        "file": "client/src/components/ExitStrategiesTab.tsx",
        "line": "181",
        "severity": "SERIOUS",
        "type": "calculation_inconsistency",
        "description": "ExitStrategiesTab wholesale calculation for double_close did not add EMD back, unlike WholesaleAnalysis.tsx which correctly handles EMD",
        "impact": "Double close net profit was understated by the EMD amount in ExitStrategiesTab",
        "affected_features": ["Exit Strategies - Wholesale Double Close"],
        "status": "FIXED",
        "fix_applied": "Added conditional to add EMD back for double_close deals: netProfit = dealType === 'double_close' ? assignmentFee - totalWholesalerCosts + earnestMoneyDeposit : assignmentFee - totalWholesalerCosts"
      },
      {
        "id": "SER-002",
        "file": "client/src/lib/calculator.ts",
        "line": "360",
        "severity": "SERIOUS",
        "type": "calculation_accuracy",
        "description": "totalLoanInterest calculation counted total payments as interest for amortized loans, overstating interest costs",
        "code_snippet": "totalLoanInterest = monthlyLoanPayment * inputs.holdingPeriodMonths;",
        "correct_approach": "For amortized loans, should calculate actual interest paid using amortization schedule",
        "impact": "For conventional loans (amortized), total financing costs were overstated as they included principal payments in the interest calculation",
        "affected_features": ["Core calculator - financing costs", "All profit calculations"],
        "status": "FIXED",
        "fix_applied": "Added conditional logic to calculate actual interest for amortized loans by iterating through the holding period and tracking only the interest portion of each payment"
      }
    ],
    "minor": [
      {
        "id": "MIN-001",
        "file": "client/src/components/BreakEvenAnalysis.tsx",
        "line": "35-45",
        "severity": "MINOR",
        "type": "edge_case",
        "description": "Break-even calculation doesn't account for all detailed selling cost fields being optional/possibly undefined",
        "impact": "If some detailed selling cost fields are undefined, they default to 0, which is acceptable but not explicitly handled",
        "affected_features": ["Break-Even Analysis"]
      },
      {
        "id": "MIN-002",
        "file": "Multiple components",
        "severity": "MINOR",
        "type": "code_duplication",
        "description": "formatCurrency and formatPercent functions are duplicated across many components instead of being shared",
        "impact": "Maintenance issue - formatting could become inconsistent if changed in some places but not others",
        "affected_features": ["All display formatting"]
      }
    ]
  },
  "calculations_verified": {
    "calculator.ts": {
      "purchaseClosingCosts": "VERIFIED - Correct calculation using percentage or fixed amount",
      "totalRehabCost": "VERIFIED - Correctly sums detailed categories or uses simple estimate",
      "downPayment": "VERIFIED - Correctly calculates based on percentage or fixed amount",
      "baseLoanAmount": "VERIFIED - amountToFinance - downPayment",
      "totalOriginationPoints": "VERIFIED - baseLoanAmount * points percentage",
      "monthlyLoanPayment_interestOnly": "VERIFIED - totalLoanAmount * monthlyRate",
      "monthlyLoanPayment_amortized": "VERIFIED - Standard amortization formula",
      "totalLoanInterest": "ISSUE - See SER-003, counts all payments as interest for amortized loans",
      "totalHoldingCosts": "VERIFIED - Sum of monthly costs * holding period",
      "sellingCommission": "VERIFIED - ARV * commission percentage",
      "sellingClosingCosts": "VERIFIED - Either percentage of ARV or sum of itemized costs",
      "totalSellingCosts": "VERIFIED - Commission + closing costs + concessions",
      "totalProjectCost": "VERIFIED - Sum of all costs",
      "totalCashNeeded": "VERIFIED - Complex but correctly handles financing scenarios",
      "netProfit": "VERIFIED - ARV - totalProjectCost",
      "roi": "VERIFIED - netProfit / totalProjectCost * 100",
      "cashOnCash": "VERIFIED - netProfit / totalCashNeeded * 100",
      "annualizedRoi": "VERIFIED - roi * (12 / holdingPeriodMonths)",
      "profitMargin": "VERIFIED - netProfit / ARV * 100"
    },
    "BRRRRAnalysis.tsx": {
      "maxLoanAmount": "VERIFIED - ARV * refinanceLTV%",
      "totalRefinanceCosts": "VERIFIED - Either itemized or 2% of ARV default",
      "cashOut": "VERIFIED - maxLoanAmount - totalRefinanceCosts",
      "cashLeftInDeal": "VERIFIED - totalInvestment - cashOut",
      "monthlyPI": "VERIFIED - Standard amortization formula",
      "noi": "VERIFIED - effectiveGrossIncome - totalOperatingExpenses",
      "monthlyCashFlow": "VERIFIED - noi - totalDebtService",
      "cashOnCash": "VERIFIED - annualCashFlow / actualCashInDeal * 100",
      "dscr": "VERIFIED - noi / totalDebtService"
    },
    "BreakEvenAnalysis.tsx": {
      "breakEvenARV": "VERIFIED - fixedCosts / (1 - sellingRates)",
      "maxPurchaseForTargetProfit": "VERIFIED - Algebraic derivation correct",
      "arvForTargetProfit": "VERIFIED - (fixedCosts + targetProfit) / (1 - sellingRates)"
    },
    "WholesaleAnalysis.tsx": {
      "assignmentFee_calculation": "VERIFIED for double close",
      "totalWholesalerCosts": "VERIFIED for structure, but EMD handling is buggy",
      "netProfit": "ISSUE - See CRIT-002",
      "endBuyerAnalysis": "VERIFIED - Standard flip analysis for end buyer"
    },
    "ExitStrategiesTab.tsx": {
      "flipAnalysis": "VERIFIED - Uses core calculator results",
      "brrrrAnalysis": "VERIFIED - Matches BRRRRAnalysis.tsx logic",
      "wholesaleAnalysis": "DIFFERS from WholesaleAnalysis.tsx - See SER-001"
    },
    "SensitivityAnalysis.tsx": {
      "adjustedInputs": "VERIFIED - Correctly applies percentage adjustments",
      "profitChange": "VERIFIED - Difference between adjusted and base results"
    },
    "PointsFeesComparison.tsx": {
      "scenarioResults": "ISSUE - See CRIT-001, loanPoints field doesn't exist",
      "totalFinancingCost": "VERIFIED - pointsCost + totalInterest + lenderFees"
    },
    "ComparisonMode.tsx": {
      "property_comparison": "VERIFIED - Uses calculateResults for each property"
    },
    "CostPerSqFt.tsx": {
      "all_per_sqft_calculations": "VERIFIED - Correctly divides totals by square footage"
    }
  },
  "input_validation_status": {
    "purchasePrice": "Basic validation - returns zeros if <= 0",
    "arv": "Basic validation - returns zeros if <= 0",
    "percentages": "No max validation - users could enter > 100%",
    "negative_values": "No explicit prevention - could cause unexpected results",
    "holding_period": "Slider constrained 1-24 months in UI"
  },
  "display_verification": {
    "currency_formatting": "VERIFIED - Consistent Intl.NumberFormat usage",
    "percentage_formatting": "VERIFIED - Consistent formatting",
    "conditional_colors": "VERIFIED - Green/red based on positive/negative values"
  },
  "fix_order": [
    {
      "priority": 1,
      "issue_id": "CRIT-001",
      "reason": "Breaks entire lender comparison feature"
    },
    {
      "priority": 2,
      "issue_id": "CRIT-002",
      "reason": "Causes incorrect wholesale profit calculations"
    },
    {
      "priority": 3,
      "issue_id": "SER-001",
      "reason": "Two components show different results - need to unify logic"
    },
    {
      "priority": 4,
      "issue_id": "SER-002",
      "reason": "EMD handling in double close is incorrect"
    },
    {
      "priority": 5,
      "issue_id": "SER-003",
      "reason": "Affects conventional loan calculations"
    }
  ]
}
